@model string;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles{
<link href="~/css/form.css" rel="stylesheet" />
<link href="~/css/data-grid.css" rel="stylesheet" />
<link href="~/css/slider.css" rel="stylesheet" />
}

<div class="row text-start">
    <h5>@($"{Language.GetString("design_Layers")} {Model}")</h5>
    <div class="offset-10 col-2">
        <a class="btn btn-sm btn-success float-end" asp-action="AddLayer" asp-controller="Slider" asp-route-sliderId="@ViewBag.SliderId" asp-route-slideId="@ViewBag.SlideId">
            <i class="fa fa-plus" aria-hidden="true"></i>
        </a>
    </div>

</div>
<div class="row">
    <div class="col-12">
        <table class="table table-responsive table-bordered table-striped align-middle">
            <thead>
                <tr>
                    <th class="text-center">@Language.GetString("tbl_RowName")</th>
                    <th>@Language.GetString("AlertAndMessage_Type")</th>
                    <th>@Language.GetString("Content")</th>
                    <th>Link</th>
                    <th>Position-Top</th>
                    <th>Position-Right</th>
                    <th>Position-Bottom</th>
                    <th>Position-Left</th>
                    <th></th>
                </tr>
            </thead>
            <tbody id="table"></tbody>
        </table>
    </div>
</div>

@*<div class="table">
    <div class="table-head d-none d-lg-block">
    <div class="table-row">
    <div class="row m-0">
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-3">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-1">
    <span></span>
    </div>
    <div class="table-col col-md-2">
    <span></span>
    </div>
    </div>
    </div>
    </div>

    <div id="table" class="table-body">
    </div>
    </div>*@

<!-- Modal remove-->
<div id="removeModal" class="modal">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <a role="button" class="modal-close" data-dismiss="modal"></a>
            <div class="modal-header">
                <h6 class="modal-title">@Language.GetString("btn_Delete") </h6>
            </div>
            <div class="modal-body text-center">
                <p class="alert warning">@Language.GetString("AlertAndMessage_DeletionSure")</p>
                <button id="delete" type="button" class="btn btn-danger btn-sm btn-modal-body" data-dismiss="modal">@Language.GetString("btn_Delete")</button>
                <button type="button" class="btn btn-outline-danger btn-sm btn-modal-body" data-dismiss="modal" style="margin-left:5px">@Language.GetString("btn_Cancel")</button>
            </div>
        </div>
    </div>
</div>

@section Scripts{
<script src="~/lib/cropperjs/cropper.min.js"></script>
<script src="~/js/cropper.js"></script>
<script src="~/lib/twbs-pagination/jquery.twbsPagination.js"></script>

    @if (ViewBag.Success != null)
    {
<script type="text/javascript">

    document.getElementById('mainToastBody').innerHTML = '<i class="far fa-check-circle"></i>'+'@ViewBag.Success';
    document.getElementById('mainToastBody').classList.add('alert-success');
    var bsAlert = new bootstrap.Toast($("#mainToast"));
    bsAlert.show();

</script>
    }

<script>
    var pageSize = 10;
    var $pagination = $('#pagination');
    var defaultOpts = {
         first: "@Language.GetString("tbl_First")",
        prev: "@Language.GetString("tbl_PreviousPage")",
        next: "@Language.GetString("tbl_NextPage")",
        last: "@Language.GetString("tbl_Last")"
    };

    var aspectCropper = 0;

    function CropperShow(img) {
        readURL(img, aspectCropper);
    }

    $('#uploadModal').on('hidden.bs.modal',
        function () {
            cropper.destroy();
            document.getElementById("Image").value = "";
            $("#cropped_result").remove();
        });

    $(document).on("click",
        "#picRecord",
        function (e) {
            e.preventDefault();
            $("#uploadModal").modal("show");
        });

    $(document).on("click",
        "#send_pic",
        function () {
            var url = $("#pic").attr("src");
            var pic = '';
            picSrc = url;

            $(".ImageWrapper img").attr("src", picSrc);

            $('#uploadModal').modal("hide");
        });

    //$('#calenderStart').MdPersianDateTimePicker({
    //    targetTextSelector: '#StartDate',
    //    targetDateSelector: '#StartDateHide',
    //    fromDate: true,
    //    enableTimePicker: true,
    //    groupId: 'rangeSelector',
    //});
    //$('#calenderEnd').MdPersianDateTimePicker({
    //    targetTextSelector: '#ExpireDate',
    //    targetDateSelector: '#ExpireDateHide',
    //    toDate: true,
    //    enableTimePicker: true,
    //    groupId: 'rangeSelector',
    //});

</script>

<script>
    $(document).ready(function() {

        list();
    });

    function list() {
        $("#table").html("");
        var data = {
            pageSize: pageSize,
            currentPage: $pagination.twbsPagination('getCurrentPage'),
            sliderId: "@(ViewBag.SliderId)",
            slideId: "@(ViewBag.SlideId)"
        };

        $.ajax({
            url: "@Url.Action("ListLayers")",
            type: 'Post',
            data: data,
            beforeSend: function() {
                //$("#loading-data").css("display", "block");
            },
            success: function(result) {

                $("#table").html(result);

                var totalPages = $("#page-data").data("total");
                var currentPage = $pagination.twbsPagination('getCurrentPage');

                $pagination.twbsPagination('destroy');

                if (totalPages > 0) {
                    $pagination.twbsPagination($.extend({},
                        defaultOpts,
                        {
                            startPage: currentPage,
                            totalPages: totalPages
                        }));
                }
            },
            error: function(xhr, ajaxOptions, thrownError) {
            },
            complete: function() {
                $("#loading-data").css("display", "none");
                //$("#loading").css("display", "none");
            }
        });

        $(document).on("click", "#deleteRecord", function(e) {
                    e.preventDefault();
                    var id = $(this).data("id");

                    $("#delete").data("id", id);
                    $("#removeModal").modal("show");

                });

            $(document).on("click", "#delete", function(e) {
                    e.preventDefault();
                    var id = $(this).data("id");
                    var data = { Id: id };

                    $.ajax({
                        url: "@Url.Action("DeleteLayer")",
                        type: 'Get',
                        data: data,
                        beforeSend: function() {
                            //$("#loading").css("display", "block");
                        },
                        success: function(result) {

                            if (result.status === "success") {
                                //var $inputs = $('#filter :input');

                                //var values1 = {};

                                //$inputs.each(function () {
                                //    values1[this.name] = $(this).val();
                                //});
                                //values1['PageSize'] = pageSize;
                                //values1['CurrentPage'] = $pagination.twbsPagination('getCurrentPage');

                                //list(values1);

                                $("#removeModal").modal("hide");
                                location.reload();
                                //Swal.fire({
                                //    type: 'success',
                                //    title: result.message,
                                //    confirmButtonText:
                                //        '<i class="fa fa-thumbs-up"></i> متوجه شدم!',
                                //});
                                document.getElementById('mainToastBody').innerHTML = '<i class="far fa-check-circle"></i>'+result.message;
                                document.getElementById('mainToastBody').classList.add('alert-success');
                                var bsAlert = new bootstrap.Toast($("#mainToast"));
                                bsAlert.show();
                                setTimeout(function()
                                {
                                       location.reload();
                                },
                                1500);

                            } else {

                                showError(result.message);
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {

                        },
                        complete: function() {
                            //$("#loading").css("display", "none");
                        }
                    });
                });
    }
</script>
}